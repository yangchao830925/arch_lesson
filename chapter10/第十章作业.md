# 一、Dubbo服务调用时序图
- 时序图  
![text](https://raw.githubusercontent.com/yangchao830925/arch_lesson/master/chapter10/Dubbo.png)

# 二、中台架构的思考和认知

### 什么是中台？
> 要定义中台，重要的是要能比较明确的区分中台和平台。中台和平台都是某种共性能力，区分两者的重点一是看是否具备业务属性，二是看是否是一种组织。中台是支持多个前台业务且具备业务属性的共性能力组织，平台是支持多个前台或中台业务且不具备业务属性的共性能力。中台的定义还要求以下两点：中台是一种共性能力组织，支持了多个业务。中台支持的是多个前台业务。

### 典型的中台有哪些？
> 除了常说的业务中台，我们还经常听到数据中台、用户中台、搜索中台、推荐中台、内容中台、技术中台、算法中台、移动中台、研发中台等等一系列的XX中台的说法，但这些中台未必都是真正的中台。前面已经说过，广义上讲业务中台包含了所有中台，不同的XX中台都是业务中台的细分方向，反映的是该中台在业务领域或者技术上的某些特征。但大家往往只用业务中台来指称在线业务中台。当前典型的真正的中台大致只有以下几个：业务中台、数据中台、用户中台、内容中台、搜索推荐中台；

### 要不要建设中台？
> 有诉求有沉淀再上中台。这如果企业本身还处于业务在探索，或者说业务本身的模式还不是特别清晰，在熟悉了解完善业务和组织的这个阶段，暂时就不需要上中台。因为中台一定是对业务的理解有足够的深度，没有深度的理解不可能做高质量的抽象和沉淀，所以企业的发展一定是到了成熟期，会有内外部协同诉求，乃至产业互联网诉求时，它有了完整的业务场景，对业务领域垂直深度也有有沉淀，另外也十分清楚“烟囱林立”的状态带来什么样的阻滞，当IT架构体系明显不能承载整个企业的业务持续的高效运转和高速发展时，就需要中台建设。

### 中台建设的支撑技术有哪些？
> 建设在线业务中台一般需要云原生、DevOps、微服务技术体系的支撑，这是因为：

> 微服务技术：中台是一个独立的组织负责并为多个前台业务服务，因此需要一个标准的服务接口、成熟的服务治理能力和高效的敏捷研发技术。在当前的技术环境下，采用地球人都熟悉的REST风格的同步API、消息队列异步通信作为标准的服务接口技术，采用服务框架（如Spring Cloud等）、API网关、APM等作为标准的服务治理和敏捷研发技术是最合适的选择。不再建议采用传统的基于ESB的服务化（SOA）技术，因为ESB产品过多的介入到业务逻辑中，导致前台业务的变更往往需要中台团队的配合才能完成，这样就失去了建设好中台，支撑前台高效创新的意义。此外，中心化的ESB软件和复杂的基于XML的WS-xxx等协议也影响到系统的可用性和性能。可以参见Martin Fowler在P of EAA中的评价，Web Services是应用集成而非应用开发的技术。

> DevOps技术：如果不通过DevOps使得各微服务都能自助式的部署更新，则微服务带来的敏捷性就无从发挥，反而因为服务数量的增加导致研发效率的下降，因此持续集成、持续发布等DevOps技术一般是实现微服务的必备。

> 云原生技术：微服务和DevOps要求底层的基础设施是灵活可编程的，否则根据Amdahl定律，只要有一个必须的环节是低效的，整体的效能也提不上去。需要强调的是中台要敏捷，这一方面是因为中台具备业务属性，且支撑了非常丰富的前台业务，前台业务的敏捷性要求有一部分就会传导的中台层；另一方面是中台的重要性使得其需要持续不断的优化，即便对外提供的服务不变，内部实现也会经常变。

> 分布式事务技术：实施微服务拆分后，复杂的业务流程不再能通过数据库的事务机制来实现ACID特性，为此还需要服务层面的分布式事务处理技术。典型的分布式事务处理模型包括TCC、Saga、FMT等。其中TCC和Saga需要各服务实现定制化回滚逻辑，侵入性比较严重，用起来门槛比较高。FMT模式对于Java可以做到加一行注解（如@GlobalTransaction）即可实现分布式事务，剩下的由框架自动处理，用起来方便的多。Saga模式是Princeton的两位研究者在1987年提出的，灵活性和并发度最好，但需要通过语义锁等精细的设计才能发挥出来。

### 中台建设的方法论？
> 对于业务中台，微服务、网关、REST API及语义化版本控制、六边形架构是侧重于技术架构的方法论，DevOps、敏捷项目管理是侧重于流程层面的方法论，领域驱动设计（DDD）是侧重于业务架构的方法论。要做好业务中台，以上方法论大概都不可或缺。
